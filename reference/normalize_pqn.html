<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Normalize intensities across samples using a Probabilistic Quotient Normalization (PQN) — normalize_pqn • metamorphr</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Normalize intensities across samples using a Probabilistic Quotient Normalization (PQN) — normalize_pqn"><meta name="description" content="This method was originally developed for H-NMR spectra of complex biofluids but has been adapted for other 'omics data. It aims to eliminate
dilution effects by calculating the most probable dilution factor for each sample, relative to one or more reference samples. See references for more details."><meta property="og:description" content="This method was originally developed for H-NMR spectra of complex biofluids but has been adapted for other 'omics data. It aims to eliminate
dilution effects by calculating the most probable dilution factor for each sample, relative to one or more reference samples. See references for more details."><meta property="og:image" content="https://yasche.github.io/metamorphr/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">metamorphr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/metamorphr.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/conjugate-screening.html">Conjugate Screening</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/yasche/metamorphr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Normalize intensities across samples using a Probabilistic Quotient Normalization (PQN)</h1>
      <small class="dont-index">Source: <a href="https://github.com/yasche/metamorphr/blob/master/R/normalize.R" class="external-link"><code>R/normalize.R</code></a></small>
      <div class="d-none name"><code>normalize_pqn.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This method was originally developed for H-NMR spectra of complex biofluids but has been adapted for other 'omics data. It aims to eliminate
dilution effects by calculating the most probable dilution factor for each sample, relative to one or more reference samples. See references for more details.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">normalize_pqn</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  fn <span class="op">=</span> <span class="st">"median"</span>,</span>
<span>  normalize_sum <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  reference_samples <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ref_as_group <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  group_column <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A tidy tibble created by <code><a href="read_featuretable.html">read_featuretable</a></code>.</p></dd>


<dt id="arg-fn">fn<a class="anchor" aria-label="anchor" href="#arg-fn"></a></dt>
<dd><p>Which function should be used to calculate the reference spectrum from the reference samples? Can be either "mean" or "median".</p></dd>


<dt id="arg-normalize-sum">normalize_sum<a class="anchor" aria-label="anchor" href="#arg-normalize-sum"></a></dt>
<dd><p>A logical indicating whether a sum normalization (aka total area normalization) should be performed prior to PQN.
It is <a href="https://rdrr.io/github/ricoderks/Rcpm/man/pqn.html" class="external-link">recommended</a> to do so and other packages (e.g., <a href="https://CRAN.R-project.org/package=KODAMA" class="external-link"><span class="pkg">KODAMA</span></a>) also perform a sum normalization prior to PQN.</p></dd>


<dt id="arg-reference-samples">reference_samples<a class="anchor" aria-label="anchor" href="#arg-reference-samples"></a></dt>
<dd><p>Either <code>NULL</code> or a character or character vector containing the sample(s)
to calculate the reference spectrum from. In the original publication, it is advised to calculate the median of control samples.
If <code>NULL</code>, all samples will be used to calculate the reference spectrum.</p></dd>


<dt id="arg-ref-as-group">ref_as_group<a class="anchor" aria-label="anchor" href="#arg-ref-as-group"></a></dt>
<dd><p>A logical indicating if <code>reference_samples</code> are the names of samples or group(s).</p></dd>


<dt id="arg-group-column">group_column<a class="anchor" aria-label="anchor" href="#arg-group-column"></a></dt>
<dd><p>Only relevant if <code>ref_as_group = TRUE</code>. Which column should be used for grouping reference and non-reference samples? Usually <code>group_column = Group</code>. Uses <code><a href="https://rlang.r-lib.org/reference/args_data_masking.html" class="external-link">args_data_masking</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A tibble with intensities normalized across samples.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>

<ul><li><p>F. Dieterle, A. Ross, G. Schlotterbeck, H. Senn, <em>Anal. Chem.</em> <strong>2006</strong>, <em>78</em>, 4281–4290, DOI 10.1021/ac051632c.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># specify the reference samples with their sample names</span></span></span>
<span class="r-in"><span><span class="va">toy_metaboscape</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="impute_lod.html">impute_lod</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">normalize_pqn</span><span class="op">(</span>reference_samples <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"QC1"</span>, <span class="st">"QC2"</span>, <span class="st">"QC3"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 110 × 8</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      UID Feature                Sample  Intensity    RT `m/z` Name       Formula</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span>     1 161.10519 Da 26.98 s   Sample1   0.115    0.45  162. <span style="color: #BB0000;">NA</span>         C7H15N…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span>     2 276.13647 Da 27.28 s   Sample1   0.086<span style="text-decoration: underline;">2</span>   0.45  277. Octyl hyd… C16H22…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span>     3 304.24023 Da 32.86 s   Sample1   0.005<span style="text-decoration: underline;">75</span>  0.55  305. Arachidon… C20H32…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span>     4 417.23236 Da 60.08 s   Sample1   0.144    1     418. <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span>     5 104.10753 Da 170.31 s  Sample1   0.144    2.84  105. <span style="color: #BB0000;">NA</span>         C5H14NO</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span>     6 105.04259 Da 199.80 s  Sample1   0.144    3.33  106. <span style="color: #BB0000;">NA</span>         C3H8NO3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span>     7 237.09204 Da 313.24 s  Sample1   0.040<span style="text-decoration: underline;">2</span>   5.22  238. Ketamine   C13H16…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span>     8 745.09111 Da 382.23 s  Sample1   0.086<span style="text-decoration: underline;">2</span>   6.37  746. NADPH      C21H30…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span>     9 427.02942 Da 424.84 s  Sample1   0.115    7.08  428. ADP        C10H15…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span>    10 1284.34904 Da 498.94 s Sample1   0.011<span style="text-decoration: underline;">5</span>   8.32 <span style="text-decoration: underline;">1</span>285. <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 100 more rows</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># specify the reference samples with their group names</span></span></span>
<span class="r-in"><span><span class="va">toy_metaboscape</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="join_metadata.html">join_metadata</a></span><span class="op">(</span><span class="va">toy_metaboscape_metadata</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="impute_lod.html">impute_lod</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">normalize_pqn</span><span class="op">(</span>reference_samples <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"QC"</span><span class="op">)</span>, ref_as_group <span class="op">=</span> <span class="cn">TRUE</span>, group_column <span class="op">=</span> <span class="va">Group</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 110 × 12</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      UID Feature      Sample Intensity    RT `m/z` Name  Formula Group Replicate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span>     1 161.10519 D… Sampl…   0.115    0.45  162. <span style="color: #BB0000;">NA</span>    C7H15N… cont…         1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span>     2 276.13647 D… Sampl…   0.086<span style="text-decoration: underline;">2</span>   0.45  277. Octy… C16H22… cont…         1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span>     3 304.24023 D… Sampl…   0.005<span style="text-decoration: underline;">75</span>  0.55  305. Arac… C20H32… cont…         1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span>     4 417.23236 D… Sampl…   0.144    1     418. <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>      cont…         1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span>     5 104.10753 D… Sampl…   0.144    2.84  105. <span style="color: #BB0000;">NA</span>    C5H14NO cont…         1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span>     6 105.04259 D… Sampl…   0.144    3.33  106. <span style="color: #BB0000;">NA</span>    C3H8NO3 cont…         1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span>     7 237.09204 D… Sampl…   0.040<span style="text-decoration: underline;">2</span>   5.22  238. Keta… C13H16… cont…         1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span>     8 745.09111 D… Sampl…   0.086<span style="text-decoration: underline;">2</span>   6.37  746. NADPH C21H30… cont…         1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span>     9 427.02942 D… Sampl…   0.115    7.08  428. ADP   C10H15… cont…         1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span>    10 1284.34904 … Sampl…   0.011<span style="text-decoration: underline;">5</span>   8.32 <span style="text-decoration: underline;">1</span>285. <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>      cont…         1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 100 more rows</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 2 more variables: Batch &lt;int&gt;, Factor &lt;dbl&gt;</span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Yannik Schermer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

